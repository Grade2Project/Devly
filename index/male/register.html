<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Регистрация</title>
    <link rel="stylesheet" href="../all.css">
    <link rel="stylesheet" href="../styleguide.css">

    <style>
        body {
            background: url("../svg/auth_bg.svg") no-repeat fixed top center;
            background-size: 2900px 1024px;
            overflow-y: scroll;
        }
    </style>
</head>
<body>
    <div class="form__container">
        <div class="form__body__FS">
            <span class="h1__central_46">Регистрация</span>
            <div class="tabs__container">
                <a class="tabs__tab" onclick="showTab(0)"><span class="tab__inner">Пользователь</span></a>
                <a class="tabs__tab" onclick="showTab(1)"><span class="tab__inner">Компания</span></a>
            </div>

            <div class="tabs__values">
                <div class="input-line">
                    <label for="reg_user_email" class="l">Почта</label><input class="text-input"
                                                                              type="email"
                                                                              id="reg_user_email"
                                                                              placeholder="example@mail.com"
                                                                              required>
                </div>
                <div class="input-line">
                    <label for="reg_user_password" class="l">Пароль</label><input class="text-input"
                                                                                  type="password"
                                                                                  id="reg_user_password"
                                                                                  required>
                </div>
                <div class="input-line">
                    <label for="reg_user_password_repeat" class="l">Повторите пароль</label><input class="text-input"
                                                                                                   type="password"
                                                                                                   id="reg_user_password_repeat"
                                                                                                   required>
                </div>
            </div>
            <div class="tabs__values">
                <div class="input-line">
                    <label for="reg_company_name" class="l">Название компании</label>
                    <input class="text-input" id="reg_company_name" required>
                </div>

                <div class="input-line">
                    <label for="reg_company_inn" class="l">ИНН</label>
                    <input class="text-input" id="reg_company_inn" minlength="10" maxlength="12" required>
                </div>

                <div class="input-line">
                    <label for="reg_company_tel" class="l">Телефон</label>
                    <input class="text-input"
                           type="tel"
                           minlength="11"
                           maxlength="12"
                           id="reg_company_tel"
                           placeholder="+7"
                           required>
                </div>

                <div class="input-line">
                    <label for="reg_company_email" class="l">Email для входа</label>
                    <input class="text-input" id="reg_company_email" type="email" required>
                </div>

                <div class="input-line">
                    <label for="reg_company_password" class="l">Пароль</label>
                    <input class="text-input" id="reg_company_password" type="password" required>
                </div>
            </div>

            <button class="button__confirm color-red" type="submit" id="reg_submit"
                    onclick="register()">
                <span class="button__confirm_inner">Зарегистрироваться</span>
            </button>
        </div>
    </div>
<script src="../scripts/tabs.js"></script>
<script src="../scripts/utils.js"></script>
<script src="../scripts/inputsValidity.js"></script>
<script>
    const userPassRepetition = document.getElementById('reg_user_password_repeat');
    const userPass= document.getElementById('reg_user_password');
    userPassRepetition.checkValidity = () => userPassRepetition.value === userPass.value;
    function register() {
        let data;
        let controller;

        if (currentTab === 0) {
            const dataRaw = getObjectFromIterable(
                document.querySelectorAll('[id^="reg_user_"]'),
                ti => [ti.id, ti.value]);

            controller = Controllers.REG.USER;
            data = {
                login: dataRaw['reg_user_email'],
                password: dataRaw['reg_user_password']
            }
        }
        else {
            const dataRaw = getObjectFromIterable(
                document.querySelectorAll('[id^="reg_company_"]'),
                ti => [ti.id, ti.value]);

            controller = Controllers.REG.COMPANY;
            data = {
                companyName: dataRaw['reg_company_name'],
                companyEmail: dataRaw['reg_company_email'],
                companyInfo: JSON.stringify({
                    companyInn: dataRaw['reg_company_inn'],
                    companyTel: dataRaw['reg_company_tel']
                }),
                password: dataRaw['reg_company_password']
            }
        }

        if (!data || !controller) throw new Error('Internal error');
        sendJSON(data, controller,
            (statusCode) => {
            if (statusCode === 200) {
                console.log('Успешная регистрация');
            }
            else { console.log('Ошибка регистрации'); }
        });
    }
</script>
</body>
</html>